crds:
  installPrometheus: false

opentelemetry-operator:
  tolerations:
    - key: "node-role.kubernetes.io/system"
      operator: "Exists"
      effect: "NoSchedule"
  nodeSelector:
    kubernetes.io/os: linux
    node-role.kubernetes.io/system: ""
  manager:
    collectorImage:
      repository: otel/opentelemetry-collector-contrib

defaultCRConfig:
  tolerations:
    - key: "node-role.kubernetes.io/control-plane"
      operator: "Exists"
      effect: "NoSchedule"
    - key: "node-role.kubernetes.io/system"
      operator: "Exists"
      effect: "NoSchedule"

collectors:
  daemon:
    scrape_configs_file: "examples/prometheus-otel/kubelet_scrape_configs.yaml"
    presets:
      logsCollection:
        enabled: false
      kubeletMetrics:
        enabled: false
      hostMetrics:
        enabled: false
      kubernetesAttributes:
        enabled: false
      kubernetesEvents:
        enabled: false
      clusterMetrics:
        enabled: false
    targetAllocator:
      enabled: true
      allocationStrategy: per-node
      prometheusCR:
        enabled: true
        podMonitorSelector: {}
        scrapeInterval: "30s"
        serviceMonitorSelector: {}
      # ipFamilyPolicy: "PreferDualStack"
      # ipFamilies: ["IPv6","IPv4"]
      nodeSelector:
        node-role.kubernetes.io/system: ""
      tolerations:
        - key: "node-role.kubernetes.io/system"
          operator: "Exists"
          effect: "NoSchedule"
    config:
      exporters:
        otlp/tempo:
          endpoint: lgtm-tempo-gateway.monitoring.svc.cluster.local:4317
          tls:
            insecure: true
        prometheusremotewrite/mimir:
          endpoint: http://lgtm-distributed-mimir-nginx.monitoring.svc.cluster.local/api/v1/push
          tls:
            insecure: true
        otlphttp/loki:
          endpoint: http://lgtm-loki-gateway.monitoring.svc/otlp
          headers:
            X-Scope-OrgID: "homelab-v2"
          tls:
            insecure: true
      service:
        pipelines:
          traces:
            exporters:
              - otlp/tempo
          metrics:
            exporters:
              - prometheusremotewrite/mimir
          logs:
            exporters:
              - otlphttp/loki

instrumentation:
  enabled: false
opAMPBridge:
  enabled: false
kubernetesServiceMonitors:
  enabled: true
kubeApiServer:
  enabled: true
kubelet:
  enabled: true
kubeControllerManager:
  enabled: true
  serviceMonitor:
    relabelings:
      - sourceLabels: [__meta_kubernetes_pod_node_name]
        targetLabel: instance
        action: replace
coreDns:
  enabled: true
  serviceMonitor:
    relabelings:
      - sourceLabels: [__meta_kubernetes_pod_node_name]
        targetLabel: instance
        action: replace
kubeEtcd:
  enabled: true
  endpoints:
    - 192.168.60.150
    - 192.168.60.151
    - 192.168.60.152
kubeScheduler:
  enabled: true
  serviceMonitor:
    relabelings:
      - sourceLabels: [__meta_kubernetes_pod_node_name]
        targetLabel: instance
        action: replace
kubeProxy:
  enabled: false 
kubeStateMetrics:
  enabled: true
kube-state-metrics:
  service:
    ipDualStack:
      enabled: true
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: "node-role.kubernetes.io/system"
                operator: "Exists"
  tolerations:
    - key: "node-role.kubernetes.io/system"
      operator: "Exists"
      effect: "NoSchedule"
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      memory: 100Mi
nodeExporter:
  enabled: true
prometheus-node-exporter:
  service:
    ipDualStack:
      enabled: true
  prometheus:
    monitor:
      relabelings:
        - sourceLabels: [__meta_kubernetes_pod_node_name]
          targetLabel: instance
          action: replace
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      memory: 100Mi
