objectStore:
  name: aistor-objectstore
  pools:
    - servers: 1
      name: pool-0
      volumesPerServer: 8
      size: 10Gi
      storageClassName: proxmox-local-zfs-xfs
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchLabels:
                  aistor.min.io/objectStore: aistor-objectstore
                  v1.min.io/pool: pool-0
              topologyKey: kubernetes.io/hostname
      resources:
        requests:
          cpu: 100m
          memory: 2Gi
        limits:
          memory: 2Gi
  metrics:
    enabled: true
  services:
    minio:
      labels:
        tenant: aistor-objectstore
  env:
    - name: MINIO_BROWSER_REDIRECT_URL
      value: "https://aistor-console.local.xuhuisun.com"
    - name: MINIO_KMS_SERVER
      value: "https://minkms-minkms.minkms.svc.cluster.local:7373"
    - name: MINIO_KMS_SSE_KEY
      value: "aistor-objectstore-default-key"
    - name: MINIO_KMS_ENCLAVE
      value: "aistor-objectstore"
    - name: MINIO_KMS_API_KEY
      value: "k1:E-4M_dXrKywZrL2r5w5vRfrrBPlmMlHluINDWRHWDyc"
    - name: MINIO_IDENTITY_OPENID_CONFIG_URL
      value: "https://iam.local.xuhuisun.com/realms/local/.well-known/openid-configuration"
    - name: MINIO_IDENTITY_OPENID_CLIENT_ID
      value: "minio"
    - name: MINIO_IDENTITY_OPENID_DISPLAY_NAME
      value: "OpenID Login - Keycloak"
    - name: MINIO_IDENTITY_OPENID_SCOPES
      value: "openid,profile,email"
    - name: MINIO_IDENTITY_OPENID_REDIRECT_URI_DYNAMIC
      value: "on"
    - name: MINIO_IDENTITY_OPENID_CLAIM_USERINFO
      value: "on"
    - name: MINIO_IDENTITY_OPENID_VENDOR
      value: "keycloak"
    - name: MINIO_IDENTITY_OPENID_KEYCLOAK_REALM
      value: "local"
    - name: MINIO_IDENTITY_OPENID_KEYCLOAK_ADMIN_URL
      value: "https://keycloak.local.xuhuisun.com/admin"


extraResources:
- |
  apiVersion: autoscaling.k8s.io/v1
  kind: VerticalPodAutoscaler
  metadata:
    name: primary-object-store
    namespace: primary-object-store
  spec:
    resourcePolicy:
      containerPolicies:
        - containerName: minio
          controlledResources:
            - cpu
            - memory
          minAllowed:
            cpu: 5m
            memory: 1Gi
          maxAllowed:
            cpu: 8
            memory: 4Gi
    targetRef:
      apiVersion: apps/v1
      kind: StatefulSet
      name: aistor-objectstore-pool-0
    updatePolicy:
      updateMode: InPlaceOrRecreate
- |
  apiVersion: monitoring.coreos.com/v1
  kind: ServiceMonitor
  metadata:
    name: aistor-objectstore
    namespace: primary-object-store
  spec:
    jobLabel: ""
    selector:
      matchLabels:
        tenant: aistor-objectstore
    namespaceSelector:
      matchNames:
      - primary-object-store  
    endpoints:
    - port: https-minio
      path: /minio/v2/metrics/cluster
      authorization:
        type: Bearer
        credentials:
          name: aistor-objectstore-prometheus-token
          key: token
      scheme: https
      tlsConfig:
        insecureSkipVerify: true
- |
  apiVersion: v1
  kind: Secret
  metadata:
    name: aistor-objectstore-prometheus-token
    namespace: primary-object-store
  type: Opaque
  stringData:
    token: eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJwcm9tZXRoZXVzIiwic3ViIjoibWluaW8iLCJleHAiOjQ5MjQwNTU4NDF9.Nab0duAn2pXCFxT5BW5sKy19N3hew_VAEzP_lktii64OO5H6eOgiUxPIpxHn7xUSra63SIwuJu8ZikLu-IxzOw